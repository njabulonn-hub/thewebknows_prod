(()=>{let f=e=>null==e||"string"==typeof e&&""===e.trim()||"—"===e?null:e,b=e=>(e=e&&String(e).match(/-?\d+(\.\d+)?/))?Number(e[0]):null,u=new Set("a an the and or but if to of in on for with this that those these is are was were be been being i you your our their can will would should could from at as about by into over under it they them we us more less most least not no".split(" ")),v={vpn:"VPN & Privacy Tools",adblock:"Ad Blockers & Anti-Tracking",password:"Password Managers & 2FA",security:"Security Suites (AV/Firewall)",secureMail:"Secure Email & Encrypted Cloud",browser:"Secure/Private Browsers",fintech:"Privacy-Focused Finance",devtools:"Developer Tools",travel:"Travel & Roaming eSIMs",streaming:"Streaming/Media Bundles"},y=t=>{let n=(t.contextText||"").toLowerCase(),o=(...e)=>e.some(e=>n.includes(e)),r=new Map,a=(e,t,n)=>{var o;t&&((o=r.get(e)||{score:0,reasons:[]}).score+=t,n&&o.reasons.push(n),r.set(e,o))};{let e=0;t.privacy?.dnt&&(e+=8,a("vpn",8,"Do Not Track is enabled")),t.adBlock&&(e+=12,a("vpn",12,"Possible ad blocker detected")),t.connection?.effectiveType&&/2g/.test(t.connection.effectiveType)&&(e+=4,a("vpn",4,"Slow network often used to pitch VPN speed boosts")),t.connection?.saveData&&(e+=4,a("vpn",4,"Data saver enabled — privacy tools often highlight compression")),!0===t.privateMode&&(e+=10,a("vpn",10,"Private/Incognito mode heuristics detected")),o("vpn","privacy","encrypted","tunnel","tracker","fingerprint","cookieless","ip address","dns leak")&&(e+=22,a("vpn",22,"Context mentions privacy/VPN keywords"))}{let e=0;t.adBlock&&(e+=24,a("adblock",24,"Ad elements appear blocked")),t.privacy?.dnt&&(e+=6,a("adblock",6,"Do Not Track aligns with blocking interests")),o("adblock","ad blocker","block ads","tracking protection")&&(e+=16,a("adblock",16,"Context mentions ad-block keywords"))}{let e=0;o("password manager","passwords","breach","2fa","passkey","multi factor","credential","phishing")&&(e+=18,a("password",18,"Security login keywords present")),(t.platform||"").toLowerCase().includes("mac")&&t.languages?.includes("en-US")&&(e+=4,a("password",4,"macOS + EN locale skew toward passkey UX campaigns"))}{let e=0;o("antivirus","malware","ransomware","endpoint","firewall","threat")&&(e+=16,a("security",16,"Security threat keywords in context")),t.webglHash&&t.webgl?.vendor&&/intel/i.test(t.webgl.vendor)&&(e+=3,a("security",3,"Typical office hardware profile (WebGL vendor)"))}{let e=0;o("encrypted email","pgp","end-to-end","zero knowledge","private email","secure cloud","encrypted storage")&&(e+=18,a("secureMail",18,"Encrypted comms/storage keywords detected")),t.privacy?.dnt&&(e+=4,a("secureMail",4,"Privacy-forward signal detected"))}{let e=0;o("private browser","privacy browser","tor","brave","firefox","tracking prevention")&&(e+=18,a("browser",18,"Private browser keywords detected")),t.userAgent&&/firefox|brave/i.test(t.userAgent)&&(e+=8,a("browser",8,"User agent suggests privacy-oriented browser"))}o("privacy card","virtual card","masked card","identity theft","chargeback","bank privacy")&&a("fintech",14,"Finance + privacy keywords detected");{let e=0;o("api","open source","github","terminal","ssh","docker","kubernetes","npm","typescript")&&(e+=18,a("devtools",18,"Developer-centric keywords detected")),(t.platform||"").toLowerCase().includes("linux")&&(e+=6,a("devtools",6,"Linux platform detected"))}{let e=0;o("esim","roaming","travel data","international plan","airport wifi","airplane wifi")&&(e+=18,a("travel",18,"Travel connectivity keywords detected")),t.connection?.effectiveType&&/(3g|4g|5g)/.test(t.connection.effectiveType)&&(e+=4,a("travel",4,"Cellular-like connection detected"))}{let e=0;o("streaming","netflix","disney","prime video","hulu","stream faster","unblock")&&(e+=14,a("streaming",14,"Streaming media keywords detected")),t.vpnScorePrelim&&10<=t.vpnScorePrelim&&(e+=6,a("streaming",6,"VPN interest often pairs with unblocking content"))}return r};window.buildAdInsights=async function(e,t={}){var n=(e=>{var t=e.network||{},n=e.browser||{},o=e.connection||{},r=e.privacy||{},a=Array.isArray(n.languages)&&n.languages.length?n.languages:navigator.languages&&navigator.languages.length?Array.from(navigator.languages):[navigator.language||null],i=a&&a.length?f(a[0]):null,s=f(t.referrer),s="None"===s?null:s;let c=null;if(s)try{c=new URL(s).hostname}catch(e){c=s}var l=b(o.downlink),d=b(o.rtt),p="string"==typeof o.saveData?"enabled"===o.saveData.toLowerCase():!!o.saveData,g=[t.city,t.region,t.country].map(e=>f(e)).filter(Boolean),u=f(t.networkType);let v=null;u&&((y=u.toLowerCase()).includes("data-center")||y.includes("vpn")?v="Data-centre/VPN (guess)":(y.includes("home")||y.includes("office"))&&(v="Home/office ISP (guess)"));var y,w=c?(y=c.toLowerCase(),/(vpn|privacy|proxy|security)/.test(y)?"Privacy/VPN contextual ads":/(game|gaming|steam|xbox|playstation)/.test(y)?"Gaming contextual ads":/(finance|bank|crypto|stock|money)/.test(y)?"Finance contextual ads":/(travel|hotel|flight|booking)/.test(y)?"Travel contextual ads":null):null;return{ip4:f(t.ipv4),ip6:f(t.ipv6),isp:f(t.isp),asn:f(t.asn),reverseDns:f(t.reverseDns),geo:g.length?{city:f(t.city),region:f(t.region),country:f(t.country),string:g.join(", ")}:null,languages:a,primaryLanguage:i,browserLabel:f(n.browser),userAgent:f(n.userAgent||("undefined"!=typeof navigator?navigator.userAgent:null)),platform:f(n.platform||n.os),osLabel:f(n.os),deviceType:f(n.deviceType),timezone:f(n.timezone),timezoneOffset:f(n.timezoneOffset),screen:n.screenWidth&&n.screenHeight?n.screenWidth+"×"+n.screenHeight:null,viewport:n.viewportWidth&&n.viewportHeight?n.viewportWidth+"×"+n.viewportHeight:null,connection:{type:f(o.type),effectiveType:f(o.effectiveType),downlinkMbps:l,rttMs:d,saveData:p},referrer:s,referrerHost:c,contextGuess:w,networkType:u,networkGuess:v,privacy:{dnt:"1"===r.doNotTrack,gpc:!!r.globalPrivacyControl,cookiesEnabled:"boolean"==typeof r.cookiesEnabled?r.cookiesEnabled:!!navigator.cookieEnabled,localStorage:f(r.localStorage),darkMode:!!r.darkMode,reducedMotion:!!r.reducedMotion},adBlock:e.fingerprints?!!e.fingerprints.adBlock:null,privateMode:e.fingerprints&&"boolean"==typeof e.fingerprints.privateMode?.private?e.fingerprints.privateMode.private:null,canvasHash:e.fingerprints?.canvas?.hash||null,webglHash:e.fingerprints?.webgl?.hash||null,audioHash:e.fingerprints?.audio?.hash||null,webgl:e.fingerprints?.webgl||null,topics:[]}})(e||{}),o=(n.topics=await(async()=>{if("undefined"!=typeof document&&"function"==typeof document.browsingTopics)try{var e=await document.browsingTopics();if(Array.isArray(e))return e}catch(e){console.warn("Chrome Topics API unavailable:",e)}return[]})(),e&&e.context&&e.context.baseText||""),t=Object.prototype.hasOwnProperty.call(t,"userText")?t.userText||"":e&&e.context&&e.context.userText||"",r=(o+`
`+t).trim().slice(0,1e5),a=(n.contextText=r,t&&t.trim()?t:o),a=((e,t)=>{if(!e||"string"!=typeof e)return[];e=e.toLowerCase().replace(/[\u2019']/g,"").replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(e=>e&&!u.has(e)&&2<e.length);let n=new Map;return e.forEach(e=>{n.set(e,(n.get(e)||0)+1)}),[...n.entries()].sort((e,t)=>t[1]-e[1]).slice(0,t).map(([e,t])=>({term:e,count:t}))})(a,20);n.keywords=a;var i,s,c,l=y({...n,vpnScorePrelim:0}).get("vpn")?.score||0,l=(e=>{let o=0,r=(e.forEach(e=>{e.score>o&&(o=e.score)}),[]);return e.forEach((e,t)=>{var n;e.score&&(n=o?Math.round(e.score/o*100):e.score,r.push({id:t,label:v[t]||t,score:e.score,norm:n,because:e.reasons}))}),r.sort((e,t)=>t.norm-e.norm),r})(y({...n,vpnScorePrelim:l})).slice(0,8),o={hasUserText:Boolean(t&&t.trim()),combinedText:r,userTextLength:t.length,baseTextLength:o.length},d=(i=n,c=a,g=o,s=(s=l).filter(e=>null!=e.norm).sort((e,t)=>t.norm-e.norm).slice(0,4).map(e=>e.label+` (${e.norm})`),d=i.topics&&i.topics.length?`Chrome Topics returned ${i.topics.length} id(s).`:"Chrome Topics not available (browser has not exposed them).",(p=[]).push("DNT "+(i.privacy.dnt?"on":"off")),p.push("GPC "+(i.privacy.gpc?"on":"off")),p.push("Cookies "+(i.privacy.cookiesEnabled?"enabled":"disabled")),i.connection.saveData&&p.push("Data Saver on"),"boolean"==typeof i.adBlock&&p.push(i.adBlock?"Ad blocker detected":"Ad blocker not detected"),"boolean"==typeof i.privateMode&&p.push(i.privateMode?"Private mode likely":"Private mode unlikely"),c=c&&c.length?"Context keywords: "+c.slice(0,5).map(e=>e.term).join(", "):"Context keywords: none detected yet.",s=[`Location & language: ${i.geo?i.geo.string:"not shared"}, ${i.primaryLanguage||"language unknown"}.`,`Device & connection: ${i.browserLabel||"browser unknown"} on ${i.osLabel||"OS unknown"} (${i.deviceType||"device unknown"}), connection ${i.connection.type||"—"} ${i.connection.effectiveType?`(${i.connection.effectiveType})`:""}, downlink ≈ ${i.connection.downlinkMbps??"—"} Mbps.`,"Top ad categories: "+(s.length?s.join(", "):"None yet – signals too limited."),d,c,`Privacy signals: ${p.join(" • ")}.`],g&&g.hasUserText&&s.push("User context: custom copy supplied in textarea."),i.referrerHost&&s.push("Referrer context: "+i.referrerHost),s.join("\n")),p={ip:{v4:(c=n).ip4?"Known":"Missing",v6:c.ip6?"Known":"Missing"},geo:c.geo?"Estimated":"Unavailable",language:c.primaryLanguage?"Known":"Unknown",topics:c.topics&&c.topics.length?"Known":"Not available",network:c.networkGuess||"Unknown",connection:null!=c.connection.downlinkMbps?"Estimated":"Unknown",privacy:{dnt:c.privacy.dnt?"Enabled":"Disabled",gpc:c.privacy.gpc?"Enabled":"Disabled",cookies:c.privacy.cookiesEnabled?"Enabled":"Disabled"}},g={ip:{v4:n.ip4,v6:n.ip6},isp:n.isp,asn:n.asn,reverseDns:n.reverseDns,geo:n.geo,browser:n.browserLabel,os:n.osLabel,deviceType:n.deviceType,languages:{primary:n.primaryLanguage,all:n.languages},timezone:n.timezone,timezoneOffset:n.timezoneOffset,screen:n.screen,viewport:n.viewport,connection:n.connection,referrer:n.referrer,topics:n.topics,privacy:n.privacy,networkGuess:n.networkGuess,adBlock:n.adBlock,privateMode:n.privateMode,canvasHash:n.canvasHash,webglHash:n.webglHash,audioHash:n.audioHash};return e&&e.context&&(e.context.userText=t,e.context.combinedText=r,e.context.keywords=a),{signals:g,status:p,categories:l,summary:d,keywords:a,context:o}}})();